---
export const prerender = false;

import { actions } from "astro:actions";
import Layout from "../layouts/Layout.astro";
import { ArrowRight } from "lucide-astro";
import { TimeDisplayed } from "../components/TimeDisplayed.tsx";
import { MessageForm } from "../components/MessageForm.tsx";
import { MessageList } from "../components/MessageList.tsx";
import { apiUrl } from "../constants";

type Greeting = {
  id: number;
  message: string;
  author: string;
  createdAt: string;
  displayedUntil: string;
  video: string;
};

const res = await fetch(`${apiUrl}/greetings`);
const messages: Greeting[] = await res.json();
---

<Layout title="Tidbyt Message Board">
  <main
    class="p-4 min-h-screen flex flex-col items-center text-text bg-gradient-to-b from-base via-crust to-mantle"
  >
    <header class="mb-8 mt-20 text-center">
      <h1
        class="text-4xl text-flamingo font-bold mb-4"
        style={{
          textShadow:
            "0 0 10px rgba(203, 166, 247, 0.7), 0 0 20px rgba(203, 166, 247, 0.5)",
        }}
      >
        Tidbyt Message Board
      </h1>
      <p class="text-muted text-lg">
        Send me a message on my Tidbyt. <a
          href="/about"
          class="whitespace-nowrap hover:text-peach"
          ><span class="underline">Learn more</span>
          <ArrowRight class="inline-block" size={14} /></a
        >
      </p>
    </header>

    <MessageForm client:load />

    <MessageList client:only initialMessages={messages} />
  </main>
</Layout>
